<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>The Lucky Number</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® style.css ‡¶è ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶è‡¶á‡¶ó‡ßÅ‡¶≤‡ßã ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá‡•§ */
        /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤-‡¶¨‡¶æ‡¶®‡ßç‡¶ß‡¶¨ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 0;
        }

        header {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        header h1 {
            margin: 0;
            font-size: 1.5rem;
        }

        .login-link {
            text-decoration: none;
            background-color: #fff;
            color: #6a11cb;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        main {
            padding: 1rem;
        }

        .results-section {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .results-section h3 {
            background-color: #e9ecef;
            color: #555;
            padding: 1rem;
            margin: 0;
            font-size: 1.25rem;
            border-bottom: 1px solid #ddd;
        }
        
        .results-container {
            padding: 1rem;
        }
        
        .result-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            color: #495057;
        }
        
        .patti-number {
            font-size: 1.5rem;
            color: #2575fc;
        }
        
        .single-number {
            font-size: 2rem;
            font-weight: bold;
            color: #6a11cb;
            background: #e0eafc;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>üéØ The Lucky Number</h1>
        <div>
            <a class="login-link" href="index-login.html">Login</a>
        </div>
    </header>

    <main>
        <section class="results-section">
            <h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü</h3>
            <div id="todayResults" class="results-container">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        </section>

        <section class="results-section">
            <h3>‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü</h3>
            <div id="oldResults" class="results-container">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        </section>
    </main>

    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
    
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/publicResults.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { firebaseConfig } from './js/firebase-config.js';
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ‡¶Ø‡ßá‡¶π‡ßá‡¶§‡ßÅ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ publicResults.js ‡¶è ‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á,
        // ‡¶§‡¶æ‡¶á ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§
        // ‡¶Ö‡¶•‡¶¨‡¶æ publicResults.js ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§
        // ‡¶®‡¶ø‡¶ö‡ßá ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶Æ‡ßÅ‡¶®‡¶æ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡¶ø‡•§
        
        import { collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const todayResultsEl = document.getElementById('todayResults');
        const oldResultsEl = document.getElementById('oldResults');

        async function loadResults() {
            try {
                const today = new Date().toLocaleDateString("en-GB");
                
                // ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶≤‡ßã‡¶°
                const todayQuery = query(collection(db, "results"), where("date", "==", today), orderBy("createdAt"));
                const todaySnap = await getDocs(todayQuery);
                
                if (todaySnap.empty) {
                    todayResultsEl.innerHTML = "<p>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</p>";
                } else {
                    todayResultsEl.innerHTML = "";
                    todaySnap.forEach(docSnap => {
                        const data = docSnap.data();
                        const item = document.createElement('div');
                        item.className = 'result-item';
                        item.innerHTML = `
                            <div class="result-header">
                                <span>‡¶ó‡ßá‡¶Æ ${data.slot}</span>
                                <span class="patti-number">${data.patti}</span>
                            </div>
                            <div class="single-number">${data.single}</div>
                        `;
                        todayResultsEl.appendChild(item);
                    });
                }
                
                // ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶≤‡ßã‡¶° (‡¶∂‡ßá‡¶∑ ‡ßß‡ß¶ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞)
                const oldQuery = query(collection(db, "results"), orderBy("createdAt", "desc"));
                const oldSnap = await getDocs(oldQuery);

                let lastTenDays = {};
                let count = 0;
                oldSnap.forEach(docSnap => {
                    const data = docSnap.data();
                    if (!lastTenDays[data.date]) {
                        if (Object.keys(lastTenDays).length >= 10) return;
                        lastTenDays[data.date] = [];
                        count++;
                    }
                    lastTenDays[data.date].push(data);
                });

                oldResultsEl.innerHTML = "";
                for (const date in lastTenDays) {
                    const dateHeader = document.createElement('h4');
                    dateHeader.textContent = `‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${date}`;
                    oldResultsEl.appendChild(dateHeader);
                    
                    lastTenDays[date].forEach(data => {
                        const item = document.createElement('div');
                        item.className = 'result-item';
                        item.innerHTML = `
                            <div class="result-header">
                                <span>‡¶ó‡ßá‡¶Æ ${data.slot}</span>
                                <span class="patti-number">${data.patti}</span>
                            </div>
                            <div class="single-number">${data.single}</div>
                        `;
                        oldResultsEl.appendChild(item);
                    });
                }

            } catch (error) {
                console.error("‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", error);
                todayResultsEl.innerHTML = "<p>‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</p>";
                oldResultsEl.innerHTML = "<p>‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</p>";
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
          loadResults();
        });
    </script>
</body>
</html>
